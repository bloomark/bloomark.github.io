CKEDITOR.plugins.add("wordcount",{lang:"ca,de,en,es,fr,it,jp,nl,no,pl,pt-br,ru,sv",version:1.1,init:function(d){function c(g){var h=document.createElement("div");h.innerHTML=g;return""==h.textContent&&"undefined"==typeof h.innerText?"":h.textContent||h.innerText}function e(h){var l=0,g=0,k,a;if(a=h.getData()){if(i.showCharCount&&(i.countHTML?g=a.length:(d.config.fullPage&&(g=a.search(/<body>/i),-1!=g&&(k=a.search(/<\/body>/i),a=a.substring(g+6,k))),k=a.replace(/(\r\n|\n|\r)/gm,"").replace(/^\s+|\s+$/g,"").replace("&nbsp;",""),i.countSpacesAsChars||(k=a.replace(/\s/g,"")),k=c(k).replace(/^([\s\t\r\n]*)$/,""),g=k.length)),i.showWordCount){k=a.replace(/(\r\n|\n|\r)/gm," ").replace(/^\s+|\s+$/g,"").replace("&nbsp;"," ");k=c(k);l=k.split(/\s+/);for(a=l.length-1;0<=a;a--){l[a].match(/^([\s\t\r\n]*)$/)&&l.splice(a,1)}l=l.length}}a=j.replace("%wordCount%",l).replace("%charCount%",g);d.plugins.wordcount.wordCount=l;d.plugins.wordcount.charCount=g;document.getElementById("cke_wordcount_"+h.name).innerHTML=a;if(g==b){return !0}b=g;return !0}if(d.elementMode!==CKEDITOR.ELEMENT_MODE_INLINE){var f='<span class="cke_path_item">',b=0,i=CKEDITOR.tools.extend({showWordCount:!0,showCharCount:!1,countSpacesAsChars:!1,countHTML:!1},d.config.wordcount||{},!0);i.showCharCount&&(f+=d.lang.wordcount[i.countHTML?"CharCountWithHTML":"CharCount"]+"&nbsp;%charCount%");i.showCharCount&&i.showWordCount&&(f+=",&nbsp;");i.showWordCount&&(f+=d.lang.wordcount.WordCount+" %wordCount%");var j=f+"</span>";CKEDITOR.document.appendStyleSheet(this.path+"css/wordcount.css");d.on("key",function(a){"source"===d.mode&&e(a.editor)},d,null,100);d.on("change",function(g){e(g.editor)},d,null,100);d.on("uiSpace",function(a){"bottom"==a.data.space&&(a.data.html+='<div id="cke_wordcount_'+a.editor.name+'" class="cke_wordcount" style="" title="'+d.lang.wordcount.title+'">&nbsp;</div>')},d,null,100);d.on("dataReady",function(g){e(g.editor)},d,null,100);d.on("afterPaste",function(g){e(g.editor)},d,null,100);d.on("blur",function(){},d,null,300);String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")})}}});